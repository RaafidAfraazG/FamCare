<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Wellness Dashboard - FamCare</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .wellness-indicator {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            color: white;
            font-weight: bold;
            margin: 20px 0;
        }
        .excellent { background-color: #4CAF50; }
        .good { background-color: #2196F3; }
        .fair { background-color: #ff9800; }
        .needs-attention { background-color: #f44336; }

        .alert-badge {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
            font-size: 0.9rem;
        }
        .critical { background-color: #ffcdd2; color: #c62828; }
        .high { background-color: #ffe0b2; color: #e65100; }
        .medium { background-color: #fff9c4; color: #f57f17; }
        .low { background-color: #c8e6c9; color: #2e7d32; }

        .member-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .member-trend { font-size: 1.2rem; margin: 0 10px; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">üè• FamCare</h1>
            <div class="nav-links">
                <span>Welcome, Parent!</span>
                <a href="/chat/family">üí¨ Family Chat</a> 
                <a href="/parent/dashboard">My Children</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="dashboard">
            <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Wellness Dashboard</h1>

            <!-- Error -->
            <div th:if="${error}" class="alert alert-error">
                <p th:text="${error}"></p>
            </div>

            <!-- Family Overall Status -->
            <div class="section">
                <h2>Family Wellness Status</h2>
                
                <div th:if="${insights != null}" class="wellness-indicator" th:classappend="${insights.familyWellnessStatus == 'Excellent ü§©' ? 'excellent' : insights.familyWellnessStatus == 'Good üòä' ? 'good' : insights.familyWellnessStatus == 'Fair üòê' ? 'fair' : 'needs-attention'}">
                    <h3 th:text="${insights.familyWellnessStatus}"></h3>
                    <p th:text="${insights.recommendation}"></p>
                </div>

                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Family Average Mood</h3>
                        <p class="mood-score" th:text="${insights != null ? #numbers.formatDecimal(insights.familyAverageMood, 1, 1) : '0'}"></p>
                        <small>/10</small>
                    </div>

                    <div class="stat-card">
                        <h3>Family Members</h3>
                        <p class="mood-score" th:text="${insights != null ? insights.totalMembers : 0}"></p>
                    </div>

                    <div class="stat-card">
                        <h3>Low Mood Alert</h3>
                        <p class="mood-score" th:text="${insights != null ? insights.lowMoodCount : 0}"></p>
                        <small>Members</small>
                    </div>

                    <div class="stat-card">
                        <h3>Trend</h3>
                        <p class="mood-score" th:text="${insights != null ? insights.trend : 'N/A'}"></p>
                    </div>
                </div>
            </div>

            <!-- Alerts Summary -->
            <div class="section" th:if="${alerts != null and alerts.size() > 0}">
                <h2>‚ö†Ô∏è Intervention Alerts</h2>
                <div style="margin: 15px 0;">
                    <span class="alert-badge critical" th:if="${#lists.size(alerts) > 0}">
                        üö® Critical: <span th:text="${#lists.size(alerts)}"></span>
                    </span>
                </div>
                <p style="color: #f44336; margin: 15px 0;">‚ö†Ô∏è Some family members need attention. <a href="/family/alerts">View detailed alerts</a></p>
            </div>

            <!-- Family Members Trends -->
            <div class="section">
                <h2>Individual Member Trends</h2>
                
                <div th:if="${trends != null and trends.size() > 0}">
                    <div th:each="trend : ${trends}" class="member-card">
                        <div>
                            <strong th:text="${trend.userName}"></strong><br>
                            <small>Weekly Avg: <span th:text="${#numbers.formatDecimal(trend.weeklyAverage, 1, 1)}"></span>/10</small>
                        </div>
                        <div class="member-trend" th:text="${trend.trend}"></div>
                        <div>
                            <span style="font-size: 0.9rem; color: #666;">
                                <span th:text="${trend.highMoodDays}"></span> good days | 
                                <span th:text="${trend.lowMoodDays}"></span> low days (7d)
                            </span>
                        </div>
                    </div>
                </div>

                <div th:unless="${trends != null and trends.size() > 0}">
                    <p>No mood data available yet.</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="action-buttons">
                <a href="/family/insights" class="btn-primary">üìä View Detailed Insights</a>
                <a href="/family/alerts" class="btn-primary">üîî View All Alerts</a>
                <a href="/parent/dashboard" class="btn-secondary">Back to Dashboard</a>
                <a href="/chat" class="btn-primary">üí¨ Open Chat</a>
            </div>
        </div>
    </div>
       
</body>
</html>